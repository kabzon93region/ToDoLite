<div class="task-card" draggable="true" data-task-id="{{ task[0] }}" data-current-status="{{ task[4] }}" data-full-description="{{ task[3]|e }}" data-comments="{{ task[15]|e }}">
    <div class="task-header">
        <div>
            <div class="task-title">
                {% set title_text = task[1][:31] %}
                {% if task[1]|length > 31 %}
                    {{ title_text }}...
                {% else %}
                    {{ title_text }}
                {% endif %}
            </div>
            <div class="task-meta">
                <span class="task-badge status-plain">
                    {{ cfg.statuses_labels[task[4]] if cfg.statuses_labels and task[4] in cfg.statuses_labels else task[4] }}
                </span>
                <span class="task-badge priority-{{ task[5] }}">
                    {% if task[5] == 'high' %}–í—ã—Å–æ–∫–∏–π
                    {% elif task[5] == 'medium' %}–°—Ä–µ–¥–Ω–∏–π
                    {% elif task[5] == 'low' %}–ù–∏–∑–∫–∏–π
                    {% endif %}
                </span>
                <span class="task-badge eisenhower-{{ task[6] }}">
                    {{ cfg.eisenhower_labels[task[6]] if cfg.eisenhower_labels and task[6] in cfg.eisenhower_labels else task[6] }}
                </span>
            </div>
        </div>
    </div>
    
    {% if task[2] %}
    <div class="task-description">
        {% set desc_text = task[2][:43] %}
        {% if task[2]|length > 43 %}
            {{ desc_text }}...
        {% else %}
            {{ desc_text }}
        {% endif %}
    </div>
    {% endif %}
    
    <div class="task-dates">
        {% if task[9] %}
        <span class="date-highlight date-scheduled" data-date="{{ task[9] }}">üìÖ –û—Ç–ª–æ–∂–µ–Ω–æ: {{ task[9]|ru_date }}</span>
        {% endif %}
        {% if task[10] %}
        <span class="date-highlight date-due" data-date="{{ task[10] }}">‚è∞ –°—Ä–æ–∫: {{ task[10]|ru_date }}</span>
        {% endif %}
    </div>
    
    {% if task[7] or task[8] %}
    <div class="task-meta">
        {% if task[7] %}
        <span>üë§ {{ task[7] }}</span>
        {% endif %}
        {% if task[8] %}
        {% set first_thread = task[8].split(',')[0].strip() %}
        {% set thread_parts = first_thread.split(' - ') %}
        {% if thread_parts|length >= 2 %}
            <a href="{{ thread_parts[1:]|join(' - ') }}" target="_blank" class="btn btn-small btn-secondary">{{ thread_parts[0] }}</a>
        {% else %}
            <a href="{{ first_thread }}" target="_blank" class="btn btn-small btn-secondary">–¢—Ä–µ–¥</a>
        {% endif %}
        {% endif %}
    </div>
    {% endif %}
    
    <div class="task-actions">
        <a href="/task/{{ task[0] }}" class="btn btn-small btn-primary">–û—Ç–∫—Ä—ã—Ç—å</a>
        {% if task[4] == 'done' or task[4] == 'cancelled' %}
        <a href="/archive_task/{{ task[0] }}" class="btn btn-small btn-secondary" 
           onclick="return confirm('–ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á—É?')">üì¶ –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å</a>
        {% endif %}
        {% if task[14] %}
        <div class="task-tags">
            {% set tags_text = task[14][:21] %}
            {% if task[14]|length > 21 %}
                {{ tags_text }}...
            {% else %}
                {{ tags_text }}
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
